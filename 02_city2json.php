<?php
$codes = [
    '新北市板橋區' => '6500001',
    '新北市三重區' => '6500002',
    '新北市中和區' => '6500003',
    '新北市永和區' => '6500004',
    '新北市新莊區' => '6500005',
    '新北市新店區' => '6500006',
    '新北市樹林區' => '6500007',
    '新北市鶯歌區' => '6500008',
    '新北市三峽區' => '6500009',
    '新北市淡水區' => '6500010',
    '新北市汐止區' => '6500011',
    '新北市瑞芳區' => '6500012',
    '新北市土城區' => '6500013',
    '新北市蘆洲區' => '6500014',
    '新北市五股區' => '6500015',
    '新北市泰山區' => '6500016',
    '新北市林口區' => '6500017',
    '新北市深坑區' => '6500018',
    '新北市石碇區' => '6500019',
    '新北市坪林區' => '6500020',
    '新北市三芝區' => '6500021',
    '新北市石門區' => '6500022',
    '新北市八里區' => '6500023',
    '新北市平溪區' => '6500024',
    '新北市雙溪區' => '6500025',
    '新北市貢寮區' => '6500026',
    '新北市金山區' => '6500027',
    '新北市萬里區' => '6500028',
    '新北市烏來區' => '6500029',
    '臺北市松山區' => '6300001',
    '臺北市信義區' => '6300002',
    '臺北市大安區' => '6300003',
    '臺北市中山區' => '6300004',
    '臺北市中正區' => '6300005',
    '臺北市大同區' => '6300006',
    '臺北市萬華區' => '6300007',
    '臺北市文山區' => '6300008',
    '臺北市南港區' => '6300009',
    '臺北市內湖區' => '6300010',
    '臺北市士林區' => '6300011',
    '臺北市北投區' => '6300012',
    '桃園市桃園區' => '6800001',
    '桃園市中壢區' => '6800002',
    '桃園市大溪區' => '6800003',
    '桃園市楊梅區' => '6800004',
    '桃園市蘆竹區' => '6800005',
    '桃園市大園區' => '6800006',
    '桃園市龜山區' => '6800007',
    '桃園市八德區' => '6800008',
    '桃園市龍潭區' => '6800009',
    '桃園市平鎮區' => '6800010',
    '桃園市新屋區' => '6800011',
    '桃園市觀音區' => '6800012',
    '桃園市復興區' => '6800013',
    '臺中市中區' => '6600001',
    '臺中市東區' => '6600002',
    '臺中市南區' => '6600003',
    '臺中市西區' => '6600004',
    '臺中市北區' => '6600005',
    '臺中市西屯區' => '6600006',
    '臺中市南屯區' => '6600007',
    '臺中市北屯區' => '6600008',
    '臺中市豐原區' => '6600009',
    '臺中市東勢區' => '6600010',
    '臺中市大甲區' => '6600011',
    '臺中市清水區' => '6600012',
    '臺中市沙鹿區' => '6600013',
    '臺中市梧棲區' => '6600014',
    '臺中市后里區' => '6600015',
    '臺中市神岡區' => '6600016',
    '臺中市潭子區' => '6600017',
    '臺中市大雅區' => '6600018',
    '臺中市新社區' => '6600019',
    '臺中市石岡區' => '6600020',
    '臺中市外埔區' => '6600021',
    '臺中市大安區' => '6600022',
    '臺中市烏日區' => '6600023',
    '臺中市大肚區' => '6600024',
    '臺中市龍井區' => '6600025',
    '臺中市霧峰區' => '6600026',
    '臺中市太平區' => '6600027',
    '臺中市大里區' => '6600028',
    '臺中市和平區' => '6600029',
    '臺南市新營區' => '6700001',
    '臺南市鹽水區' => '6700002',
    '臺南市白河區' => '6700003',
    '臺南市柳營區' => '6700004',
    '臺南市後壁區' => '6700005',
    '臺南市東山區' => '6700006',
    '臺南市麻豆區' => '6700007',
    '臺南市下營區' => '6700008',
    '臺南市六甲區' => '6700009',
    '臺南市官田區' => '6700010',
    '臺南市大內區' => '6700011',
    '臺南市佳里區' => '6700012',
    '臺南市學甲區' => '6700013',
    '臺南市西港區' => '6700014',
    '臺南市七股區' => '6700015',
    '臺南市將軍區' => '6700016',
    '臺南市北門區' => '6700017',
    '臺南市新化區' => '6700018',
    '臺南市善化區' => '6700019',
    '臺南市新市區' => '6700020',
    '臺南市安定區' => '6700021',
    '臺南市山上區' => '6700022',
    '臺南市玉井區' => '6700023',
    '臺南市楠西區' => '6700024',
    '臺南市南化區' => '6700025',
    '臺南市左鎮區' => '6700026',
    '臺南市仁德區' => '6700027',
    '臺南市歸仁區' => '6700028',
    '臺南市關廟區' => '6700029',
    '臺南市龍崎區' => '6700030',
    '臺南市永康區' => '6700031',
    '臺南市東區' => '6700032',
    '臺南市南區' => '6700033',
    '臺南市北區' => '6700034',
    '臺南市安南區' => '6700035',
    '臺南市安平區' => '6700036',
    '臺南市中西區' => '6700037',
    '高雄市鹽埕區' => '6400001',
    '高雄市鼓山區' => '6400002',
    '高雄市左營區' => '6400003',
    '高雄市楠梓區' => '6400004',
    '高雄市三民一' => '6400005',
    '高雄市三民二' => '6400005',
    '高雄市三民區' => '6400005',
    '高雄市新興區' => '6400006',
    '高雄市前金區' => '6400007',
    '高雄市苓雅區' => '6400008',
    '高雄市前鎮區' => '6400009',
    '高雄市旗津區' => '6400010',
    '高雄市小港區' => '6400011',
    '高雄市鳳山一' => '6400012',
    '高雄市鳳山二' => '6400012',
    '高雄市鳳山區' => '6400012',
    '高雄市林園區' => '6400013',
    '高雄市大寮區' => '6400014',
    '高雄市大樹區' => '6400015',
    '高雄市大社區' => '6400016',
    '高雄市仁武區' => '6400017',
    '高雄市鳥松區' => '6400018',
    '高雄市岡山區' => '6400019',
    '高雄市橋頭區' => '6400020',
    '高雄市燕巢區' => '6400021',
    '高雄市田寮區' => '6400022',
    '高雄市阿蓮區' => '6400023',
    '高雄市路竹區' => '6400024',
    '高雄市湖內區' => '6400025',
    '高雄市茄萣區' => '6400026',
    '高雄市永安區' => '6400027',
    '高雄市彌陀區' => '6400028',
    '高雄市梓官區' => '6400029',
    '高雄市旗山區' => '6400030',
    '高雄市美濃區' => '6400031',
    '高雄市六龜區' => '6400032',
    '高雄市甲仙區' => '6400033',
    '高雄市杉林區' => '6400034',
    '高雄市內門區' => '6400035',
    '高雄市茂林區' => '6400036',
    '高雄市桃源區' => '6400037',
    '高雄市那瑪夏區' => '6400038',
    '宜蘭縣宜蘭市' => '1000201',
    '宜蘭縣羅東鎮' => '1000202',
    '宜蘭縣蘇澳鎮' => '1000203',
    '宜蘭縣頭城鎮' => '1000204',
    '宜蘭縣礁溪鄉' => '1000205',
    '宜蘭縣壯圍鄉' => '1000206',
    '宜蘭縣員山鄉' => '1000207',
    '宜蘭縣冬山鄉' => '1000208',
    '宜蘭縣五結鄉' => '1000209',
    '宜蘭縣三星鄉' => '1000210',
    '宜蘭縣大同鄉' => '1000211',
    '宜蘭縣南澳鄉' => '1000212',
    '新竹縣竹北市' => '1000401',
    '新竹縣關西鎮' => '1000404',
    '新竹縣新埔鎮' => '1000403',
    '新竹縣竹東鎮' => '1000402',
    '新竹縣湖口鄉' => '1000405',
    '新竹縣橫山鄉' => '1000408',
    '新竹縣新豐鄉' => '1000406',
    '新竹縣芎林鄉' => '1000407',
    '新竹縣寶山鄉' => '1000410',
    '新竹縣北埔鄉' => '1000409',
    '新竹縣峨眉鄉' => '1000411',
    '新竹縣尖石鄉' => '1000412',
    '新竹縣五峰鄉' => '1000413',
    '苗栗縣苗栗市' => '1000501',
    '苗栗縣頭份市' => '1000505',
    '苗栗縣苑裡鎮' => '1000502',
    '苗栗縣通霄鎮' => '1000503',
    '苗栗縣竹南鎮' => '1000504',
    '苗栗縣後龍鎮' => '1000506',
    '苗栗縣卓蘭鎮' => '1000507',
    '苗栗縣大湖鄉' => '1000508',
    '苗栗縣公館鄉' => '1000509',
    '苗栗縣銅鑼鄉' => '1000510',
    '苗栗縣南庄鄉' => '1000511',
    '苗栗縣頭屋鄉' => '1000512',
    '苗栗縣三義鄉' => '1000513',
    '苗栗縣西湖鄉' => '1000514',
    '苗栗縣造橋鄉' => '1000515',
    '苗栗縣三灣鄉' => '1000516',
    '苗栗縣獅潭鄉' => '1000517',
    '苗栗縣泰安鄉' => '1000518',
    '彰化縣彰化市' => '1000701',
    '彰化縣員林市' => '1000710',
    '彰化縣鹿港鎮' => '1000702',
    '彰化縣和美鎮' => '1000703',
    '彰化縣北斗鎮' => '1000719',
    '彰化縣溪湖鎮' => '1000711',
    '彰化縣田中鎮' => '1000712',
    '彰化縣二林鎮' => '1000720',
    '彰化縣線西鄉' => '1000704',
    '彰化縣伸港鄉' => '1000705',
    '彰化縣福興鄉' => '1000706',
    '彰化縣秀水鄉' => '1000707',
    '彰化縣花壇鄉' => '1000708',
    '彰化縣芬園鄉' => '1000709',
    '彰化縣大村鄉' => '1000713',
    '彰化縣埔鹽鄉' => '1000714',
    '彰化縣埔心鄉' => '1000715',
    '彰化縣永靖鄉' => '1000716',
    '彰化縣社頭鄉' => '1000717',
    '彰化縣二水鄉' => '1000718',
    '彰化縣田尾鄉' => '1000721',
    '彰化縣埤頭鄉' => '1000722',
    '彰化縣芳苑鄉' => '1000723',
    '彰化縣大城鄉' => '1000724',
    '彰化縣竹塘鄉' => '1000725',
    '彰化縣溪州鄉' => '1000726',
    '南投縣南投市' => '1000801',
    '南投縣埔里鎮' => '1000802',
    '南投縣草屯鎮' => '1000803',
    '南投縣竹山鎮' => '1000804',
    '南投縣集集鎮' => '1000805',
    '南投縣名間鄉' => '1000806',
    '南投縣鹿谷鄉' => '1000807',
    '南投縣中寮鄉' => '1000808',
    '南投縣魚池鄉' => '1000809',
    '南投縣國姓鄉' => '1000810',
    '南投縣水里鄉' => '1000811',
    '南投縣信義鄉' => '1000812',
    '南投縣仁愛鄉' => '1000813',
    '雲林縣斗六市' => '1000901',
    '雲林縣斗南鎮' => '1000902',
    '雲林縣虎尾鎮' => '1000903',
    '雲林縣西螺鎮' => '1000904',
    '雲林縣土庫鎮' => '1000905',
    '雲林縣北港鎮' => '1000906',
    '雲林縣古坑鄉' => '1000907',
    '雲林縣大埤鄉' => '1000908',
    '雲林縣莿桐鄉' => '1000909',
    '雲林縣林內鄉' => '1000910',
    '雲林縣二崙鄉' => '1000911',
    '雲林縣崙背鄉' => '1000912',
    '雲林縣麥寮鄉' => '1000913',
    '雲林縣東勢鄉' => '1000914',
    '雲林縣褒忠鄉' => '1000915',
    '雲林縣臺西鄉' => '1000916',
    '雲林縣元長鄉' => '1000917',
    '雲林縣四湖鄉' => '1000918',
    '雲林縣口湖鄉' => '1000919',
    '雲林縣水林鄉' => '1000920',
    '嘉義縣太保市' => '1001001',
    '嘉義縣朴子市' => '1001002',
    '嘉義縣布袋鎮' => '1001003',
    '嘉義縣大林鎮' => '1001004',
    '嘉義縣民雄鄉' => '1001005',
    '嘉義縣溪口鄉' => '1001006',
    '嘉義縣新港鄉' => '1001007',
    '嘉義縣六腳鄉' => '1001008',
    '嘉義縣東石鄉' => '1001009',
    '嘉義縣義竹鄉' => '1001010',
    '嘉義縣鹿草鄉' => '1001011',
    '嘉義縣水上鄉' => '1001012',
    '嘉義縣中埔鄉' => '1001013',
    '嘉義縣竹崎鄉' => '1001014',
    '嘉義縣梅山鄉' => '1001015',
    '嘉義縣番路鄉' => '1001016',
    '嘉義縣大埔鄉' => '1001017',
    '嘉義縣阿里山鄉' => '1001018',
    '屏東縣屏東市' => '1001301',
    '屏東縣潮州鎮' => '1001302',
    '屏東縣東港鎮' => '1001303',
    '屏東縣恆春鎮' => '1001304',
    '屏東縣萬丹鄉' => '1001305',
    '屏東縣長治鄉' => '1001306',
    '屏東縣麟洛鄉' => '1001307',
    '屏東縣九如鄉' => '1001308',
    '屏東縣里港鄉' => '1001309',
    '屏東縣鹽埔鄉' => '1001310',
    '屏東縣高樹鄉' => '1001311',
    '屏東縣萬巒鄉' => '1001312',
    '屏東縣內埔鄉' => '1001313',
    '屏東縣竹田鄉' => '1001314',
    '屏東縣新埤鄉' => '1001315',
    '屏東縣枋寮鄉' => '1001316',
    '屏東縣新園鄉' => '1001317',
    '屏東縣崁頂鄉' => '1001318',
    '屏東縣林邊鄉' => '1001319',
    '屏東縣南州鄉' => '1001320',
    '屏東縣佳冬鄉' => '1001321',
    '屏東縣琉球鄉' => '1001322',
    '屏東縣車城鄉' => '1001323',
    '屏東縣滿州鄉' => '1001324',
    '屏東縣枋山鄉' => '1001325',
    '屏東縣三地門鄉' => '1001326',
    '屏東縣霧臺鄉' => '1001327',
    '屏東縣瑪家鄉' => '1001328',
    '屏東縣泰武鄉' => '1001329',
    '屏東縣來義鄉' => '1001330',
    '屏東縣春日鄉' => '1001331',
    '屏東縣獅子鄉' => '1001332',
    '屏東縣牡丹鄉' => '1001333',
    '臺東縣臺東市' => '1001401',
    '臺東縣成功鎮' => '1001402',
    '臺東縣關山鎮' => '1001403',
    '臺東縣卑南鄉' => '1001404',
    '臺東縣大武鄉' => '1001410',
    '臺東縣太麻里鄉' => '1001409',
    '臺東縣東河鄉' => '1001407',
    '臺東縣長濱鄉' => '1001408',
    '臺東縣鹿野鄉' => '1001405',
    '臺東縣池上鄉' => '1001406',
    '臺東縣綠島鄉' => '1001411',
    '臺東縣延平鄉' => '1001413',
    '臺東縣海端鄉' => '1001412',
    '臺東縣達仁鄉' => '1001415',
    '臺東縣金峰鄉' => '1001414',
    '臺東縣蘭嶼鄉' => '1001416',
    '花蓮縣花蓮市' => '1001501',
    '花蓮縣鳳林鎮' => '1001502',
    '花蓮縣玉里鎮' => '1001503',
    '花蓮縣新城鄉' => '1001504',
    '花蓮縣吉安鄉' => '1001505',
    '花蓮縣壽豐鄉' => '1001506',
    '花蓮縣光復鄉' => '1001507',
    '花蓮縣豐濱鄉' => '1001508',
    '花蓮縣瑞穗鄉' => '1001509',
    '花蓮縣富里鄉' => '1001510',
    '花蓮縣秀林鄉' => '1001511',
    '花蓮縣萬榮鄉' => '1001512',
    '花蓮縣卓溪鄉' => '1001513',
    '澎湖縣馬公市' => '1001601',
    '澎湖縣湖西鄉' => '1001602',
    '澎湖縣白沙鄉' => '1001603',
    '澎湖縣西嶼鄉' => '1001604',
    '澎湖縣望安鄉' => '1001605',
    '澎湖縣七美鄉' => '1001606',
    '基隆市中正區' => '1001701',
    '基隆市七堵區' => '1001702',
    '基隆市暖暖區' => '1001703',
    '基隆市仁愛區' => '1001704',
    '基隆市中山區' => '1001705',
    '基隆市安樂區' => '1001706',
    '基隆市信義區' => '1001707',
    '新竹市東區' => '1001801',
    '新竹市北區' => '1001802',
    '新竹市香山區' => '1001803',
    '嘉義市東區' => '1002001',
    '嘉義市西區' => '1002002',
    '金門縣金城鎮' => '0902001',
    '金門縣金湖鎮' => '0902003',
    '金門縣金沙鎮' => '0902002',
    '金門縣金寧鄉' => '0902004',
    '金門縣烈嶼鄉' => '0902005',
    '金門縣烏坵鄉' => '0902006',
    '連江縣南竿鄉' => '0900701',
    '連江縣北竿鄉' => '0900702',
    '連江縣莒光鄉' => '0900703',
    '連江縣東引鄉' => '0900704',
];
foreach (glob(__DIR__ . '/population/*/*/data.csv') as $csvFile) {
    $fh = fopen($csvFile, 'r');
    $header = fgetcsv($fh, 4096);
    if (false === strpos($header[0], '統計年月')) {
        $header = fgetcsv($fh, 4096);
    }
    $header[0] = '統計年月';
    $y = false;
    $result = [];
    while ($line = fgetcsv($fh, 2048)) {
        $data = array_combine($header, $line);
        if (false === $y) {
            $y = intval(substr($data['統計年月'], 0, 3)) + 1911;
            $m = substr($data['統計年月'], 3);
            $jsonPath = __DIR__ . '/json/city/' . $y;
            if (!file_exists($jsonPath)) {
                mkdir($jsonPath, 0777, true);
            }
        }
        $data['區域別'] = str_replace([' ', '　'], '', $data['區域別']);
        switch ($data['區域別']) {
            case '高雄市三民一':
            case '高雄市三民二':
                $data['區域別'] = '高雄市三民區';
                break;
            case '高雄市鳳山一':
            case '高雄市鳳山二':
                $data['區域別'] = '高雄市鳳山區';
                break;
        }

        $code = $codes[$data['區域別']];
        if (!isset($result[$code])) {
            $result[$code] = [
                'area' => $data['區域別'],
                'households' => $data['戶數'],
                'population' => $data['人口數'],
                'male' => $data['人口數-男'],
                'female' => $data['人口數-女'],
            ];
        } else {
            $result[$code]['households'] += $data['戶數'];
            $result[$code]['population'] += $data['人口數'];
            $result[$code]['male'] += $data['人口數-男'];
            $result[$code]['female'] += $data['人口數-女'];
        }
    }
    file_put_contents($jsonPath . '/' . $m . '.json', json_encode($result, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE));
}
